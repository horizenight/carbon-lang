<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-design docs-doc-id-expressions/implicit_conversions">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<title data-rh="true">Implicit conversions | Carbon Language</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://emlai.github.io/carbon-lang/design/expressions/implicit_conversions"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-design-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-design-current"><meta data-rh="true" property="og:title" content="Implicit conversions | Carbon Language"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><link data-rh="true" rel="icon" href="/carbon-lang/img/carbon-logo.png"><link data-rh="true" rel="canonical" href="https://emlai.github.io/carbon-lang/design/expressions/implicit_conversions"><link data-rh="true" rel="alternate" href="https://emlai.github.io/carbon-lang/design/expressions/implicit_conversions" hreflang="en"><link data-rh="true" rel="alternate" href="https://emlai.github.io/carbon-lang/design/expressions/implicit_conversions" hreflang="x-default"><link rel="stylesheet" href="/carbon-lang/assets/css/styles.0141378e.css">
<link rel="preload" href="/carbon-lang/assets/js/runtime~main.3ad223b0.js" as="script">
<link rel="preload" href="/carbon-lang/assets/js/main.b824e67a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/carbon-lang/"><div class="navbar__logo"><img src="/carbon-lang/img/carbon-logo.png" alt="Carbon Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/carbon-lang/img/carbon-logo.png" alt="Carbon Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Carbon Language</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/carbon-lang/design">Design</a><a class="navbar__item navbar__link" href="/carbon-lang/spec">Spec</a><a class="navbar__item navbar__link" href="/carbon-lang/project">Project</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/carbon-language/carbon-lang" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/carbon-lang/design">Language design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/carbon-lang/design/aliases">Aliases</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/carbon-lang/design/blocks_and_statements">Blocks and statements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/carbon-lang/design/classes">Classes</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/carbon-lang/design/code_and_name_organization">Code and name organization</a><button aria-label="Toggle the collapsible sidebar category &#x27;Code and name organization&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/carbon-lang/design/control_flow">Control flow</a><button aria-label="Toggle the collapsible sidebar category &#x27;Control flow&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/carbon-lang/design/expressions">Expressions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Expressions&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/carbon-lang/design/expressions/arithmetic">Arithmetic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/carbon-lang/design/expressions/as_expressions">`as` expressions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/carbon-lang/design/expressions/bitwise">Bitwise and shift operators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/carbon-lang/design/expressions/comparison_operators">Comparison operators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/carbon-lang/design/expressions/if">`if` expressions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/carbon-lang/design/expressions/implicit_conversions">Implicit conversions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/carbon-lang/design/expressions/logical_operators">Logical operators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/carbon-lang/design/expressions/member_access">Qualified names and member access</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/carbon-lang/design/functions">Functions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/carbon-lang/design/generics">Generics</a><button aria-label="Toggle the collapsible sidebar category &#x27;Generics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/carbon-lang/design/interoperability">Bidirectional interoperability with C/C++</a><button aria-label="Toggle the collapsible sidebar category &#x27;Bidirectional interoperability with C/C++&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/carbon-lang/design/lexical_conventions">Lexical conventions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Lexical conventions&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/carbon-lang/design/metaprogramming">Metaprogramming</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/carbon-lang/design/name_lookup">Name lookup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/carbon-lang/design/naming_conventions">Naming conventions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/carbon-lang/design/pattern_matching">Pattern matching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/carbon-lang/design/primitive_types">Primitive types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/carbon-lang/design/templates">Templates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/carbon-lang/design/tuples">Tuples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/carbon-lang/design/type_inference">Type inference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/carbon-lang/design/variables">Variables</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/carbon-lang/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/carbon-lang/design/expressions"><span itemprop="name">Expressions</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Implicit conversions</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Implicit conversions</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="table-of-contents">Table of contents<a class="hash-link" href="#table-of-contents" title="Direct link to heading">​</a></h2><ul><li><a href="#overview">Overview</a></li><li><a href="#properties-of-implicit-conversions">Properties of implicit conversions</a><ul><li><a href="#lossless">Lossless</a></li><li><a href="#semantics-preserving">Semantics-preserving</a></li><li><a href="#examples">Examples</a></li></ul></li><li><a href="#built-in-types">Built-in types</a><ul><li><a href="#data-types">Data types</a></li><li><a href="#same-type">Same type</a></li><li><a href="#pointer-conversions">Pointer conversions</a></li><li><a href="#type-of-types">Type-of-types</a></li></ul></li><li><a href="#consistency-with-as">Consistency with <code>as</code></a></li><li><a href="#extensibility">Extensibility</a></li><li><a href="#alternatives-considered">Alternatives considered</a></li><li><a href="#references">References</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h2><p>When an expression appears in a context in which an expression of a specific
type is expected, the expression is implicitly converted to that type if
possible.</p><p>For <a href="#built-in-types">built-in types</a>, implicit conversions are permitted when:</p><ul><li>The conversion is <a href="#lossless"><em>lossless</em></a>: every possible value for the
source expression converts to a distinct value in the target type.</li><li>The conversion is <a href="#semantics-preserving"><em>semantics-preserving</em></a>:
corresponding values in the source and destination type have the same
abstract meaning.</li></ul><p>These rules aim to ensure that implicit conversions are unsurprising: the value
that is provided as the operand of an operation should match how that operation
interprets the value, because the identity and abstract meaning of the value are
preserved by any implicit conversions that are applied.</p><p>It is possible for user-defined types to <a href="#extensibility">extend</a> the set of
valid implicit conversions. Such extensions are expected to also follow these
rules.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="properties-of-implicit-conversions">Properties of implicit conversions<a class="hash-link" href="#properties-of-implicit-conversions" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="lossless">Lossless<a class="hash-link" href="#lossless" title="Direct link to heading">​</a></h3><p>We expect implicit conversion to never lose information: if two values are
distinguishable before the conversion, they should generally be distinguishable
after the conversion. It should be possible to define a conversion in the
opposite direction that restores the original value, but such a conversion is
not expected to be provided in general, and might be computationally expensive.</p><p>Because an implicit conversion is converting from a narrower type to a wider
type, implicit conversions do not necessarily preserve static information about
the source value.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="semantics-preserving">Semantics-preserving<a class="hash-link" href="#semantics-preserving" title="Direct link to heading">​</a></h3><p>We expect implicit conversions to preserve the meaning of converted values. The
assessment of this criterion will necessarily be subjective, because the
meanings of values generally live in the mind of the programmer rather than in
the program text. However, the semantic interpretation is expected to be
consistent from one conversion to another, so we can provide a test: if multiple
paths of implicit conversions from a type <code>A</code> to a type <code>B</code> exist, and the same
value of type <code>A</code> would convert to different values of type <code>B</code> along different
paths, then at least one of those conversions must not be semantics-preserving.</p><p>A semantics-preserving conversion does not necessarily preserve the meaning of
particular syntax when applied to the value. The same syntax may map to
different operations in the new type. For example, division may mean different
things in integer and floating-point types, and member access may find different
members in a derived class pointer versus in a base class pointer.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a class="hash-link" href="#examples" title="Direct link to heading">​</a></h3><p>Conversion from <code>i32</code> to <code>Vector(int)</code> by forming a vector of N zeroes is
lossless but not semantics-preserving.</p><p>Conversion from <code>i32</code> to <code>f32</code> by rounding to the nearest representable value is
semantics-preserving but not lossless.</p><p>Conversion from <code>String</code> to <code>StringView</code> is lossless, because we can compute the
<code>String</code> value from the <code>StringView</code> value, and semantics-preserving because the
string value denoted is the same. Conversion in the other direction may or may
not be semantics-preserving depending on whether we consider the address to be a
salient part of a <code>StringView</code>&#x27;s value.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="built-in-types">Built-in types<a class="hash-link" href="#built-in-types" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-types">Data types<a class="hash-link" href="#data-types" title="Direct link to heading">​</a></h3><p>The following implicit numeric conversions are available:</p><ul><li><code>iN</code> or <code>uN</code> -&gt; <code>iM</code> if <code>M</code> &gt; <code>N</code></li><li><code>uN</code> -&gt; <code>uM</code> if <code>M</code> &gt; <code>N</code></li><li><code>fN</code> -&gt; <code>fM</code> if <code>M</code> &gt; <code>N</code></li><li><code>iN</code> or <code>uN</code> -&gt; <code>fM</code> if every value of type <code>iN</code> or <code>uN</code> can be represented
in <code>fM</code>:<ul><li><code>i12</code> or <code>u11</code> (or smaller) -&gt; <code>f16</code></li><li><code>i25</code> or <code>u24</code> (or smaller) -&gt; <code>f32</code></li><li><code>i54</code> or <code>u53</code> (or smaller) -&gt; <code>f64</code></li><li><code>i65</code> or <code>u64</code> (or smaller) -&gt; <code>f80</code> (x86 only)</li><li><code>i114</code> or <code>u113</code> (or smaller) -&gt; <code>f128</code> (if available)</li><li><code>i238</code> or <code>u237</code> (or smaller) -&gt; <code>f256</code> (if available)</li></ul></li></ul><p>In each case, the numerical value is the same before and after the conversion.
An integer zero is translated into a floating-point positive zero.</p><p>An integer constant can be implicitly converted to any type <code>iM</code>, <code>uM</code>, or <code>fM</code>
in which that value can be exactly represented. A floating-point constant can be
implicitly converted to any type <code>fM</code> in which that value is between the least
representable finite value and the greatest representable finite value
(inclusive), and converts to the nearest representable finite value, with ties
broken by picking the value for which the mantissa is even.</p><p>The above conversions are also precisely those that C++ considers non-narrowing,
except:</p><ul><li><p>Carbon also permits integer to floating-point conversions in more cases. The
most important of these is that Carbon permits <code>i32</code> to be implicitly
converted to <code>f64</code>. Lossy conversions, such as from <code>i32</code> to <code>f32</code>, are not
permitted.</p></li><li><p>What Carbon considers to be an integer constant or floating-point constant
may differ from what C++ considers to be a constant expression.</p><p><strong>Note:</strong> We have not yet decided what will qualify as a constant in this
context, but it will include at least integer and floating-point literals,
with optional enclosing parentheses. It is possible that such constants will
have singleton types; see issue
<a href="https://github.com/carbon-language/carbon-lang/issues/508" target="_blank" rel="noopener noreferrer">#508</a>.</p></li></ul><p>In addition to the above rules, a negative integer constant <code>k</code> can be
implicitly converted to the type <code>uN</code> if the value <code>k</code> + 2<sup>N</sup> can be
exactly represented, and converts to that value. Note that this conversion
violates the &quot;semantics-preserving&quot; test. For example, <code>(-1 as u8) as i32</code>
produces the value <code>255</code> whereas <code>-1 as i32</code> produces the value <code>-1</code>. However,
this conversion is important in order to allow bitwise operations with masks, so
we allow it:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// We allow ^0 == -1 to convert to `u32` to represent an all-ones value.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var a: u32 = ^0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ^4 == -5 is negative, but we want to allow it to convert to u32 here.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var b: u32 = a &amp; ^4;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="same-type">Same type<a class="hash-link" href="#same-type" title="Direct link to heading">​</a></h3><p>The following conversion is available for every type <code>T</code>:</p><ul><li><code>T</code> -&gt; <code>T</code></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pointer-conversions">Pointer conversions<a class="hash-link" href="#pointer-conversions" title="Direct link to heading">​</a></h3><p>The following pointer conversion is available:</p><ul><li><code>T*</code> -&gt; <code>U*</code> if <code>T</code> is a class derived from the class <code>U</code>.</li></ul><p>Even though we can convert <code>Derived*</code> to <code>Base*</code>, we cannot convert <code>Derived**</code>
to <code>Base**</code> because that would allow storing a <code>Derived2*</code> into a <code>Derived*</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">abstract class Base {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Derived extends Base {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Derived2 extends Base {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var d2: Derived2 = {};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var p: Derived*;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var q: Derived2* = &amp;d2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var r: Base** = &amp;p;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Bad: would store q to p.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*r = q;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="type-of-types">Type-of-types<a class="hash-link" href="#type-of-types" title="Direct link to heading">​</a></h3><p>A type <code>T</code> with <a href="/carbon-lang/design/generics/terminology#type-of-type">type-of-type</a> <code>TT1</code>
can be implicitly converted to the type-of-type <code>TT2</code> if <code>T</code>
<a href="/carbon-lang/design/generics/details#subtyping-between-type-of-types">satisfies the requirements</a>
of <code>TT2</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="consistency-with-as">Consistency with <code>as</code><a class="hash-link" href="#consistency-with-as" title="Direct link to heading">​</a></h2><p>An implicit conversion of an expression <code>E</code> of type <code>T</code> to type <code>U</code>, when
permitted, always has the same meaning as the
<a href="/carbon-lang/design/expressions/as_expressions">explicit cast expression <code>E as U</code></a>. Moreover, because such
an implicit conversion is expected to exactly preserve the value,
<code>(E as U) as T</code>, if valid, should be expected to result in the same value as
produced by <code>E</code> even if the <code>as T</code> cast cannot be performed as an implicit
conversion.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="extensibility">Extensibility<a class="hash-link" href="#extensibility" title="Direct link to heading">​</a></h2><p>Implicit conversions can be defined for user-defined types such as
<a href="/carbon-lang/design/classes">classes</a> by implementing the <code>ImplicitAs</code> interface, which
extends
<a href="/carbon-lang/design/expressions/as_expressions#extensibility">the <code>As</code> interface used to implement <code>as</code> expressions</a>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">interface ImplicitAs(Dest:! Type) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  extends As(Dest);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Inherited from As(Dest):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // fn Convert[me: Self]() -&gt; Dest;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When attempting to implicitly convert an expression <code>x</code> to type <code>U</code>, the
expression is rewritten to <code>x.(ImplicitAs(U).Convert)()</code>.</p><p>Note that implicit conversions are not transitive. Even if an
<code>impl A as ImplicitAs(B)</code> and an <code>impl B as ImplicitAs(C)</code> are both provided, an
expression of type <code>A</code> cannot be implicitly converted to type <code>C</code>. Allowing
transitivity would introduce the risk of ambiguity issues as code evolves and
would in general require a search of a potentially unbounded set of intermediate
types.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="alternatives-considered">Alternatives considered<a class="hash-link" href="#alternatives-considered" title="Direct link to heading">​</a></h2><ul><li><a href="https://github.com/carbon-language/carbon-lang/blob/trunk//proposals/p0820.md#c-conversions" target="_blank" rel="noopener noreferrer">Provide lossy and non-semantics-preserving implicit conversions from C++</a></li><li><a href="https://github.com/carbon-language/carbon-lang/blob/trunk//proposals/p0820.md#no-conversions" target="_blank" rel="noopener noreferrer">Provide no implicit conversions</a></li><li><a href="https://github.com/carbon-language/carbon-lang/blob/trunk//proposals/p0820.md#no-extensibility" target="_blank" rel="noopener noreferrer">Provide no extensibility</a></li><li><a href="https://github.com/carbon-language/carbon-lang/blob/trunk//proposals/p0820.md#transitivity" target="_blank" rel="noopener noreferrer">Apply implicit conversions transitively</a></li><li><a href="https://github.com/carbon-language/carbon-lang/blob/trunk//proposals/p1191.md#converting-complements-to-unsigned-types" target="_blank" rel="noopener noreferrer">Do not allow negative constants to convert to unsigned types</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a class="hash-link" href="#references" title="Direct link to heading">​</a></h2><ul><li><a href="https://en.cppreference.com/w/cpp/language/implicit_conversion" target="_blank" rel="noopener noreferrer">Implicit conversions in C++</a></li><li>Proposal
<a href="https://github.com/carbon-language/carbon-lang/pull/820" target="_blank" rel="noopener noreferrer">#820: Implicit conversions</a>.</li><li>Proposal
<a href="https://github.com/carbon-language/carbon-lang/pull/866" target="_blank" rel="noopener noreferrer">#866: Allow ties in floating literals</a>.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/implicit_conversions.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/carbon-lang/design/expressions/if"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">`if` expressions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/carbon-lang/design/expressions/logical_operators"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Logical operators</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#table-of-contents" class="table-of-contents__link toc-highlight">Table of contents</a></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#properties-of-implicit-conversions" class="table-of-contents__link toc-highlight">Properties of implicit conversions</a><ul><li><a href="#lossless" class="table-of-contents__link toc-highlight">Lossless</a></li><li><a href="#semantics-preserving" class="table-of-contents__link toc-highlight">Semantics-preserving</a></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a></li></ul></li><li><a href="#built-in-types" class="table-of-contents__link toc-highlight">Built-in types</a><ul><li><a href="#data-types" class="table-of-contents__link toc-highlight">Data types</a></li><li><a href="#same-type" class="table-of-contents__link toc-highlight">Same type</a></li><li><a href="#pointer-conversions" class="table-of-contents__link toc-highlight">Pointer conversions</a></li><li><a href="#type-of-types" class="table-of-contents__link toc-highlight">Type-of-types</a></li></ul></li><li><a href="#consistency-with-as" class="table-of-contents__link toc-highlight">Consistency with <code>as</code></a></li><li><a href="#extensibility" class="table-of-contents__link toc-highlight">Extensibility</a></li><li><a href="#alternatives-considered" class="table-of-contents__link toc-highlight">Alternatives considered</a></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/carbon-language/carbon-lang" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/ZjVdShJDAs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/carbon-language/carbon-lang/blob/trunk/CODE_OF_CONDUCT.md" target="_blank" rel="noopener noreferrer" class="footer__link-item">Code of Conduct<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/carbon-lang/assets/js/runtime~main.3ad223b0.js"></script>
<script src="/carbon-lang/assets/js/main.b824e67a.js"></script>
</body>
</html>